code from Phil Hwang <B.Hwang@hud.ac.uk>